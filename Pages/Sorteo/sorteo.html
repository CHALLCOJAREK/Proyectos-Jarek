<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sorteo PRO</title>
  <meta name="description" content="Página de sorteos profesional para eventos y webinars. Sin anuncios, 100% local." />
<style>
   :root {
  --bg: #0b1020;
  --panel: #0f172a;       /* slate-900 */
  --panel-2: #111827;     /* gray-900  */
  --muted: #94a3b8;       /* slate-400 */
  --text: #e5e7eb;        /* gray-200  */
  --brand: #22d3ee;       /* cyan-400  */
  --brand-2: #60a5fa;     /* blue-400  */
  --ok: #34d399;
  --warn: #f59e0b;
  --err: #ef4444;
  --shadow: 0 20px 60px rgba(0, 0, 0, .45), inset 0 0 0 1px rgba(255, 255, 255, .04);
  --radius: 18px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  background:
    radial-gradient(1200px 800px at 80% -10%, rgba(34, 211, 238, .2), transparent 60%),
    radial-gradient(1000px 600px at 10% 110%, rgba(96, 165, 250, .15), transparent 60%),
    var(--bg);
  color: var(--text);
  /* Más respiro arriba y abajo */
  padding-block: clamp(20px, 4vh, 48px);
}

a { color: var(--brand); }

.wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding-inline: 28px;
}

/* Header más centrado y con aire */
header {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 22px;                      /* +espacio */
  margin-bottom: 28px;            /* +espacio */
}

.logo-slot {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: flex-start;
}

.logo {
  width: 200px;                   /* +ancho */
  height: 140px;                   /* +alto  */
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.08);
  display: grid;
  place-items: center;
  overflow: hidden;
  box-shadow: var(--shadow);
}
.logo img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, .3));
}

/* Título refinado */
.title {
  text-align: center;
}
.title h1 {
  margin: 0;
  font-size: clamp(26px, 5vw, 42px);   /* +tamaño */
  letter-spacing: .2px;
  line-height: 1.15;
}
.title small {
  display: block;
  margin-top: 8px;
  color: var(--muted);
  font-size: clamp(14px, 1.8vw, 16px); /* +tamaño */
  line-height: 1.4;
  font-weight: 500;                    /* +presencia */
}

/* Grid principal con más respiración */
.grid {
  display: grid;
  grid-template-columns: 340px 1fr;
  gap: 26px;                            /* +gap */
}
@media (max-width: 980px) {
  .grid { grid-template-columns: 1fr; }
}

/* Cards más limpias */
.card {
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.08);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
.card .hd {
  padding: 18px 20px;                   /* +padding */
  border-bottom: 1px solid rgba(255,255,255,.06);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.card .hd h3 {
  margin: 0;
  font-size: 15px;
  font-weight: 650;
  letter-spacing: .2px;
  color: #dbeafe;
}
.card .bd { padding: 20px; }            /* +padding */

.muted { color: var(--muted); font-size: 12px; }

/* Inputs con foco elegante */
label {
  font-size: 12px;
  color: var(--muted);
  display: block;
  margin-bottom: 8px;
}

textarea,
input[type="text"],
input[type="number"] {
  width: 100%;
  background: #0b1220;
  border: 1px solid rgba(255,255,255,.08);
  color: var(--text);
  border-radius: 12px;
  padding: 12px 14px;
  font-size: 14px;
  outline: none;
  transition: border-color .2s ease, box-shadow .2s ease;
}
textarea { min-height: 180px; resize: vertical; }
textarea:focus,
input[type="text"]:focus,
input[type="number"]:focus {
  border-color: rgba(96,165,250,.45);
  box-shadow: 0 0 0 4px rgba(96,165,250,.12);
}

input[type="file"] { display: none; }

.file-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  border: none;
  border-radius: 12px;
  font-size: 12px;
  color:rgba(255,255,255,.01);
  cursor: pointer;
  transition: border-color .2s ease, transform .06s ease;
}
.file-btn:hover { border-color: rgba(255,255,255,.28); }
.file-btn:active { transform: translateY(1px); }

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 12px;
}

/* Botones con micro-animaciones */
button {
  appearance: none;
  border: 0;
  border-radius: 12px;
  padding: 12px 14px;
  font-weight: 700;
  cursor: pointer;
  transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
}
button:active { transform: translateY(1px); }

.btn {
  background: linear-gradient(180deg, var(--brand), var(--brand-2));
  color: #081018;
  box-shadow: 0 8px 22px rgba(56, 189, 248, .25);
}
.btn:hover { filter: brightness(1.05); }

.btn-secondary {
  background: #0b1220;
  border: 1px solid rgba(255,255,255,.10);
  color: var(--text);
}
.btn-secondary:hover { border-color: rgba(255,255,255,.18); }

.btn-ghost {
  background: transparent;
  border: 1px solid rgba(255,255,255,.16);
  color: var(--text);
}
.btn-ghost:hover { border-color: rgba(255,255,255,.26); }

.btn-ok {
  background: linear-gradient(180deg, #34d399, #10b981);
  color: #07160f;
}
.btn-warn {
  background: linear-gradient(180deg, #f59e0b, #f97316);
  color: #231403;
}
.btn-danger {
  background: linear-gradient(180deg, #ef4444, #dc2626);
  color: #2b0a0a;
}

/* Viewer con más presencia */
.viewer {
  height: 260px;                         /* +alto */
  border-radius: 16px;
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border: 1px solid rgba(255,255,255,.06);
  display: grid;
  place-items: center;
  position: relative;
  overflow: hidden;
}

.name {
  font-size: clamp(24px, 6vw, 48px);     /* +tamaño */
  font-weight: 800;
  letter-spacing: .6px;
  text-align: center;
  filter: drop-shadow(0 3px 12px rgba(0, 0, 0, .4));
}

/* Ticker más suave */
.ticker {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.ticker span { will-change: transform; display: inline-block; }

.winners { display: grid; gap: 12px; }    /* +gap */
.winner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 14px;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(52,211,153,.08), rgba(52,211,153,.03));
  border: 1px solid rgba(52,211,153,.25);
}
.winner small { color: var(--muted); }

/* Footer con separación visual */
.footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 22px;
  padding-top: 14px;                      /* +aire */
  color: var(--muted);
  font-size: 12px;
  border-top: 1px solid rgba(255,255,255,.06);
}

/* Confeti */
canvas#fx {
  position: fixed;
  inset: 0;
  pointer-events: none;
}

/* Accesibilidad: respeta reduce-motion */
@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; }
}

  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="wrap">
    <header>
      <div class="logo-slot">
        <div class="logo" id="logo1"><span class="muted">Logo 1</span></div>
        <label class="file-btn" for="logo1Input">Cargar logo 1</label>
        <input id="logo1Input" type="file" accept="image/*" />
      </div>
      <div class="title" style="text-align:center">
        <h1>
        <span style="background:linear-gradient(90deg,var(--brand),var(--brand-2));-webkit-background-clip:text;background-clip:text;color:transparent">
            Cashflow360
        </span>
        & 
        <span style="background:linear-gradient(90deg,var(--brand-2),var(--brand));-webkit-background-clip:text;background-clip:text;color:transparent">
            Process Doctor
        </span>
        </h1>
        <small>Aumenta la rentabilidad de tu empresa: Logra la mejora de tu ciclo de conversión de efectivo en 21 días.</small>
      </div>
      <div class="logo-slot" style="justify-self:end">
        <label class="file-btn" for="logo2Input">Cargar logo 2</label>
        <input id="logo2Input" type="file" accept="image/*" />
        <div class="logo" id="logo2"><span class="muted">Logo 2</span></div>
      </div>
    </header>

    <div class="grid">
      <!-- Columna izquierda: Configuración -->
      <section class="card">
        <div class="hd"><h3>Participantes</h3><span class="muted" id="count">0</span></div>
        <div class="bd">
          <label for="names">Una persona por línea. También puedes pegar desde Excel.</label>
          <textarea id="names" placeholder="Ejemplo:\nAna Pérez\nCarlos Vega\n…"></textarea>

          <div class="controls">
            <button class="btn-secondary" id="loadCsv">Importar CSV</button>
            <input id="csvInput" type="file" accept=".csv,text/csv" style="display:none" />
            <button class="btn-ghost" id="clean">Limpiar lista</button>
            <button class="btn-ghost" id="dedupe" title="Eliminar duplicados">Quitar duplicados</button>
          </div>

          <hr style="border:0;border-top:1px solid rgba(255,255,255,.08);margin:16px 0" />

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div>
              <label for="winners">Cantidad de ganadores</label>
              <input id="winners" type="number" min="1" value="1" />
            </div>
            <div>
              <label for="accent">Color de acento</label>
              <input id="accent" type="text" value="#22d3ee" />
            </div>
          </div>

          <div class="controls" style="margin-top:16px">
            <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="noRepeat" checked /> Evitar repetir ganadores</label>
            <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="shuffleOnStart" checked /> Mezclar al iniciar</label>
          </div>

          <div class="controls" style="margin-top:16px">
            <button class="btn" id="start">Iniciar sorteo</button>
            <button class="btn-warn" id="stop" disabled>Detener</button>
            <button class="btn-secondary" id="fullscreen">Pantalla completa</button>
          </div>
        </div>
      </section>

      <!-- Columna derecha: Escena y resultados -->
      <section class="card">
        <div class="hd"><h3>Escena del sorteo</h3></div>
        <div class="bd">
          <div class="viewer" id="viewer" style="--accent:var(--brand)">
            <div class="ticker"><span class="name" id="ticker">Listo para comenzar ✨</span></div>
          </div>

          <div class="controls">
            <button class="btn-ok" id="confirmWin" disabled>Confirmar ganador</button>
            <button class="btn-secondary" id="reroll" disabled>Volver a sortear</button>
            <button class="btn-danger" id="reset" title="Reiniciar todo">Reiniciar</button>
            <button class="btn-secondary" id="exportCsv">Exportar ganadores (CSV)</button>
          </div>

          <div style="margin-top:18px" class="card">
            <div class="hd"><h3>Ganadores</h3><span class="muted" id="winsCount">0</span></div>
            <div class="bd winners" id="winnersList"></div>
          </div>
        </div>
      </section>
    </div>

    <div class="footer">
      <div>Atajos: <span class="muted">[Enter] Iniciar/Detener • [G] Confirmar ganador • [R] Re-sortear</span></div>
      <div></div>
    </div>
  </div>

<script>
  // ===== Utilidades =====
  const $ = (q)=>document.querySelector(q);
  const $$ = (q)=>[...document.querySelectorAll(q)];
  const byLine = (txt)=> txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const unique = (arr)=>[...new Set(arr)];
  const nowStr = ()=> new Date().toLocaleString();

  // ===== Estado =====
  let participants = [];
  let winners = [];
  let spinning = false;
  let rafId = null;
  let currentName = null;

  // ===== Elementos =====
  const namesEl = $('#names');
  const countEl = $('#count');
  const startBtn = $('#start');
  const stopBtn = $('#stop');
  const rerollBtn = $('#reroll');
  const confirmBtn = $('#confirmWin');
  const resetBtn = $('#reset');
  const winnersEl = $('#winnersList');
  const winsCountEl = $('#winsCount');
  const viewer = $('#viewer');
  const ticker = $('#ticker');
  const winnersQty = $('#winners');
  const noRepeat = $('#noRepeat');
  const shuffleOnStart = $('#shuffleOnStart');
  const accent = $('#accent');
  const exportCsvBtn = $('#exportCsv');
  const fullscreenBtn = $('#fullscreen');

  // ===== Logos =====
  const logo1Box = $('#logo1');
  const logo2Box = $('#logo2');
  const logo1Input = $('#logo1Input');
  const logo2Input = $('#logo2Input');

  function loadLogo(input, box){
    const file = input.files[0];
    if(!file) return;
    const img = document.createElement('img');
    img.alt = 'Logo';
    const url = URL.createObjectURL(file);
    img.onload = ()=> URL.revokeObjectURL(url);
    img.src = url;
    box.innerHTML='';
    box.appendChild(img);
  }
  logo1Input.addEventListener('change', ()=>loadLogo(logo1Input, logo1Box));
  logo2Input.addEventListener('change', ()=>loadLogo(logo2Input, logo2Box));

  // ===== Participantes =====
  function syncParticipants(){
    participants = unique(byLine(namesEl.value));
    countEl.textContent = participants.length;
  }
  namesEl.addEventListener('input', syncParticipants);
  $('#clean').addEventListener('click', ()=>{namesEl.value=''; syncParticipants();});
  $('#dedupe').addEventListener('click', ()=>{namesEl.value = unique(byLine(namesEl.value)).join('\n'); syncParticipants();});

  // Importar CSV simple (primera columna)
  $('#loadCsv').addEventListener('click', ()=> $('#csvInput').click());
  $('#csvInput').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      const lines = reader.result.split(/\r?\n/).map(l=>l.split(',')[0]).filter(Boolean);
      namesEl.value = (namesEl.value? namesEl.value+'\n': '') + lines.join('\n');
      syncParticipants();
    };
    reader.readAsText(f,'utf-8');
  });

  // ===== Sorteo =====
  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  function spin(){
    const speed = 90; // ms entre cambios de nombre
    let last = 0;
    const loop = (t)=>{
      if(!spinning){cancelAnimationFrame(rafId); return;}
      if(!last || t-last > speed){
        if(participants.length===0){ ticker.textContent = 'Sin participantes'; }
        else{
          const pool = noRepeat.checked ? participants.filter(p=>!winners.some(w=>w.name===p)) : participants;
          if(pool.length===0){ ticker.textContent = 'No quedan elegibles'; }
          else{
            currentName = pool[Math.floor(Math.random()*pool.length)];
            ticker.textContent = currentName;
          }
        }
        last = t;
      }
      rafId = requestAnimationFrame(loop);
    };
    rafId = requestAnimationFrame(loop);
  }

  function start(){
    syncParticipants();
    if(participants.length===0){ alert('Agrega participantes primero.'); return; }
    if(shuffleOnStart.checked) participants = shuffle(participants);
    spinning = true;
    startBtn.disabled = true; stopBtn.disabled = false; rerollBtn.disabled = true; confirmBtn.disabled = true;
    ticker.style.transform = 'scale(1)';
    spin();
  }

  function stop(){
    spinning = false;
    startBtn.disabled = false; stopBtn.disabled = true; rerollBtn.disabled = false; confirmBtn.disabled = false;
    celebrate();
    ticker.style.transform = 'scale(1.06)';
  }

  function addWinner(name){
    if(!name) return;
    const item = { name, time: nowStr() };
    winners.push(item);
    winsCountEl.textContent = winners.length;
    const row = document.createElement('div');
    row.className = 'winner';
    row.innerHTML = `<strong>${escapeHtml(name)}</strong><small>${item.time}</small>`;
    winnersEl.prepend(row);

    // Evitar exceder cantidad deseada
    if(winners.length >= Number(winnersQty.value)){
      startBtn.disabled = true;
      confirmBtn.disabled = true;
      rerollBtn.disabled = true;
    }
  }

  function reroll(){
    if(spinning) return; // safety
    start(); setTimeout(stop, 1200 + Math.random()*900);
  }

  function resetAll(){
    spinning=false; cancelAnimationFrame(rafId);
    winners = []; winsCountEl.textContent = '0'; winnersEl.innerHTML='';
    ticker.textContent = 'Listo para comenzar ✨';
    startBtn.disabled=false; stopBtn.disabled=true; rerollBtn.disabled=true; confirmBtn.disabled=true;
  }

  // ===== Exportar CSV =====
  function exportCsv(){
    if(winners.length===0){ alert('No hay ganadores para exportar.'); return; }
    const header = 'Nombre,Fecha y hora\n';
    const lines = winners.map(w=>`"${w.name.replace(/"/g,'""')}","${w.time}"`).join('\n');
    const csv = header + lines;
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'ganadores.csv'; a.click();
    setTimeout(()=> URL.revokeObjectURL(url), 500);
  }

  // ===== Colores y estilo =====
  accent.addEventListener('input', ()=>{
    const v = accent.value.trim();
    viewer.style.setProperty('--accent', v);
    viewer.style.borderColor = hexToRgba(v,.35);
  });

  // ===== Pantalla completa =====
  fullscreenBtn.addEventListener('click', ()=>{
    const el = document.documentElement;
    if(!document.fullscreenElement){ el.requestFullscreen?.(); }
    else { document.exitFullscreen?.(); }
  });

  // ===== Eventos Buttons =====
  startBtn.addEventListener('click', start);
  stopBtn.addEventListener('click', stop);
  confirmBtn.addEventListener('click', ()=>{ addWinner(currentName); });
  rerollBtn.addEventListener('click', reroll);
  resetBtn.addEventListener('click', resetAll);
  exportCsvBtn.addEventListener('click', exportCsv);

  // Atajos
  window.addEventListener('keydown', (e)=>{
    if(e.key==='Enter') (spinning? stop() : start());
    if(e.key.toLowerCase()==='g' && !spinning && !confirmBtn.disabled) confirmBtn.click();
    if(e.key.toLowerCase()==='r' && !spinning && !rerollBtn.disabled) rerollBtn.click();
  });

  // ===== Confeti mínimo (canvas) =====
  const fx = $('#fx');
  const ctx = fx.getContext('2d');
  let pieces = [];
  function resize(){ fx.width = innerWidth; fx.height = innerHeight; }
  addEventListener('resize', resize); resize();
  function celebrate(){
    const n = 160; pieces = [];
    for(let i=0;i<n;i++){
      pieces.push({
        x: Math.random()*fx.width,
        y: -20 - Math.random()*50,
        s: 4 + Math.random()*6,
        a: Math.random()*Math.PI*2,
        v: 1 + Math.random()*3,
        r: (Math.random()-.5)*0.2,
        c: i%3===0?accent.value:'#60a5fa'
      });
    }
    const start = performance.now();
    function anim(t){
      ctx.clearRect(0,0,fx.width,fx.height);
      for(const p of pieces){
        p.y += p.v; p.a += p.r; p.x += Math.sin(p.a)*0.8; 
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
        ctx.fillStyle = p.c; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); ctx.restore();
      }
      if(t-start < 2200) requestAnimationFrame(anim);
    }
    requestAnimationFrame(anim);
  }

  // ===== Helpers =====
  function escapeHtml(s){
    return s.replace(/[&<>\"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }
  function hexToRgba(hex, alpha){
    if(!hex) return 'rgba(255,255,255,.2)';
    const h = hex.replace('#','');
    const bigint = parseInt(h.length===3? h.split('').map(x=>x+x).join(''):h,16);
    const r=(bigint>>16)&255,g=(bigint>>8)&255,b=bigint&255;
    return `rgba(${r},${g},${b},${alpha||1})`;
  }

  // Init
  syncParticipants();
  viewer.style.borderColor = hexToRgba(accent.value,.35);
</script>
</body>
</html>
